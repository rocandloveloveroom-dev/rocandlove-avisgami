<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roc & Love - Admin Dashboard</title>
    <link rel="icon" type="image/png" href="./assets/favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @font-face{font-family:'Brittany Signature';src:url('./assets/BrittanySignature.ttf') format('truetype')}
        .brittany{font-family:'Brittany Signature',cursive}.georgia{font-family:Georgia,serif}.cormorant{font-family:'Cormorant Garamond',serif}
        .blur-bubble{position:fixed;width:24rem;height:24rem;border-radius:50%;filter:blur(80px);opacity:.2;pointer-events:none}
        .stat-card{background:linear-gradient(135deg,rgba(185,163,120,.1),rgba(15,23,42,.9));border:1px solid rgba(185,163,120,.3);border-radius:1rem;padding:1.5rem;transition:all .3s}
        .stat-card:hover{border-color:rgba(185,163,120,.6);transform:translateY(-2px)}
        .code-badge{display:inline-block;padding:.25rem .75rem;border-radius:999px;background:rgba(15,23,42,.9);border:1px solid rgba(148,163,184,.4);font-family:'Courier New',monospace;font-weight:700;font-size:.875rem}
        .code-ROCLOVE10{background:rgba(96,165,250,.2);color:#60a5fa}.code-ROCLOVE15{background:rgba(139,92,246,.2);color:#8b5cf6}
        .code-ROCLOVE20{background:rgba(52,211,153,.2);color:#34d399}.code-ROCLOVECHAMP{background:rgba(251,191,36,.15);color:#fbbf24}
        .tab-button{padding:.75rem 1.5rem;border-radius:999px;border:1px solid rgba(148,163,184,.4);background:rgba(15,23,42,.8);color:#e5e7eb;font-size:.95rem;transition:all .2s}
        .tab-button:hover{border-color:#b9a378;color:#fef3c7;transform:translateY(-1px)}
        .tab-button.active{background:linear-gradient(135deg,#b9a378,#8b7355);color:#111827;border-color:transparent}
        .input-field{width:100%;padding:.6rem .75rem;border-radius:.75rem;background:rgba(15,23,42,.9);border:1px solid rgba(148,163,184,.5);color:#e5e7eb;font-size:.9rem}
        .input-field:focus{outline:none;border-color:#b9a378;box-shadow:0 0 0 1px rgba(185,163,120,.3)}
        .badge{display:inline-flex;align-items:center;gap:.35rem;padding:.25rem .6rem;border-radius:999px;font-size:.75rem;border:1px solid rgba(148,163,184,.5);background:rgba(15,23,42,.8)}
        .badge-dot{width:.5rem;height:.5rem;border-radius:999px}
        .badge-direct{border-color:rgba(52,211,153,.6);background:rgba(6,95,70,.3)}.badge-direct .badge-dot{background:#22c55e}
        .badge-booking{border-color:rgba(59,130,246,.6);background:rgba(30,64,175,.3)}.badge-booking .badge-dot{background:#3b82f6}
        .badge-airbnb{border-color:rgba(244,114,182,.6);background:rgba(159,18,57,.3)}.badge-airbnb .badge-dot{background:#f97316}
        table th,table td{padding:.6rem .75rem;border-bottom:1px solid rgba(31,41,55,.9)}table th{font-weight:600;font-size:.8rem;text-transform:uppercase;letter-spacing:.05em;color:#9ca3af}
        table tbody tr:nth-child(even){background:rgba(15,23,42,.7)}table tbody tr:hover{background:rgba(31,41,55,.95)}
        .prize-card{border-radius:1rem;background:linear-gradient(135deg,rgba(15,23,42,.95),rgba(17,24,39,.98));border:1px solid rgba(75,85,99,.8);padding:1.25rem;transition:all .2s}
        .prize-card:hover{border-color:#b9a378;transform:translateY(-1px)}
        .switch{position:relative;display:inline-block;width:46px;height:24px}
        .switch input{opacity:0;width:0;height:0}
        .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#4b5563;transition:.2s;border-radius:999px}
        .slider:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background-color:white;transition:.2s;border-radius:50%}
        input:checked+.slider{background-color:#b9a378}
        input:checked+.slider:before{transform:translateX(22px)}
        .pill{display:inline-flex;align-items:center;gap:.35rem;padding:.2rem .7rem;border-radius:999px;font-size:.7rem;border:1px solid rgba(148,163,184,.5);background:rgba(15,23,42,.85)}
        .pill-label{color:#9ca3af;text-transform:uppercase;letter-spacing:.08em;font-size:.65rem}
        details summary::-webkit-details-marker{display:none}
        details summary{list-style:none}
    </style>
</head>
<body class="bg-slate-950 text-gray-100 min-h-screen relative overflow-x-hidden">
    <div class="blur-bubble" style="top:-8rem;left:-6rem;background:radial-gradient(circle,#b9a378,transparent)"></div>
    <div class="blur-bubble" style="bottom:-10rem;right:-4rem;background:radial-gradient(circle,#6366f1,transparent)"></div>

    <div class="relative z-10 max-w-6xl mx-auto px-4 py-10">
        <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8">
            <div>
                <h1 class="brittany text-4xl sm:text-5xl" style="color:#B9A378">Roc & Love</h1>
                <p class="georgia text-sm text-gray-400 mt-1">Dashboard de gamification des avis üíå</p>
            </div>
            <div class="text-right">
                <p class="georgia text-xs text-gray-400 mb-1">Mode Admin s√©curis√©</p>
                <div class="inline-flex items-center gap-2 px-3 py-2 rounded-full border border-emerald-500/40 bg-emerald-900/20">
                    <span class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></span>
                    <span class="georgia text-xs text-emerald-200">En ligne</span>
                </div>
            </div>
        </header>

        <main class="space-y-8">
            <section class="grid md:grid-cols-[2fr,1.3fr] gap-6 mb-6">
                <div class="stat-card">
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <p class="georgia text-xs text-gray-400 uppercase tracking-wide">Avis collect√©s</p>
                            <p class="georgia text-3xl font-bold mt-1" id="totalReviews">‚Äì</p>
                        </div>
                        <span class="text-3xl">üíå</span>
                    </div>
                    <p class="georgia text-xs text-gray-400">Nombre total de participations au jeu via la page Roc & Love.</p>
                </div>

                <div class="stat-card">
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <p class="georgia text-xs text-gray-400 uppercase tracking-wide">Taux de clics</p>
                            <p class="georgia text-3xl font-bold mt-1" id="clickRate">‚Äì</p>
                        </div>
                        <span class="text-3xl">‚ú®</span>
                    </div>
                    <p class="georgia text-xs text-gray-400">Part des clients ayant cliqu√© pour laisser un avis.</p>
                </div>

                <div class="stat-card">
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <p class="georgia text-xs text-gray-400 uppercase tracking-wide">Avis Google directs</p>
                            <p class="georgia text-3xl font-bold mt-1" id="googleReviews">‚Äì</p>
                        </div>
                        <span class="text-3xl">‚≠ê</span>
                    </div>
                    <p class="georgia text-xs text-gray-400">Part de clients venant directement sur Google.</p>
                </div>

                <div class="stat-card">
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <p class="georgia text-xs text-gray-400 uppercase tracking-wide">Taux de grattage</p>
                            <p class="georgia text-3xl font-bold mt-1" id="scratchRate">‚Äì</p>
                        </div>
                        <span class="text-3xl">üéÅ</span>
                    </div>
                    <p class="georgia text-xs text-gray-400">Clients qui vont au bout du jeu et d√©couvrent leur cadeau.</p>
                </div>
            </section>

            <section class="bg-slate-950/70 border border-yellow-900/40 rounded-3xl p-4 sm:p-5 mb-6">
                <div class="flex flex-wrap items-center justify-between gap-3">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-2xl bg-gradient-to-br from-yellow-500/70 to-amber-700/70 flex items-center justify-center shadow-lg shadow-yellow-900/40">
                            <span class="text-2xl">üéØ</span>
                        </div>
                        <div>
                            <p class="georgia text-xs text-gray-400 uppercase tracking-wide">Vue d'ensemble</p>
                            <p class="georgia text-sm text-gray-200">G√©n√®re tes liens, suis les avis et r√©compenses de tes clients.</p>
                        </div>
                    </div>
                    <div class="flex flex-wrap gap-2 text-xs">
                        <div class="pill">
                            <span class="pill-label">Google Direct</span>
                            <span>‚≠ê</span>
                        </div>
                        <div class="pill">
                            <span class="pill-label">Plateformes</span>
                            <span>üè® Booking ‚Ä¢ üè† Airbnb</span>
                        </div>
                        <div class="pill">
                            <span class="pill-label">Jeu</span>
                            <span>Carte √† gratter üé≤</span>
                        </div>
                    </div>
                </div>
            </section>

            <section class="bg-slate-950/70 border border-yellow-900/40 rounded-3xl p-4 sm:p-5">
                <div class="flex gap-3 mb-8 flex-wrap">
                    <button onclick="showTab('generator')" id="tab-generator" class="tab-button active cormorant font-bold">ü™Ñ G√©n√©rateur</button>
                    <button onclick="showTab('stats')" id="tab-stats" class="tab-button cormorant font-bold">üìä Stats</button>
                    <button onclick="showTab('prizes')" id="tab-prizes" class="tab-button cormorant font-bold">üéÅ Lots</button>
                    <button onclick="showTab('history')" id="tab-history" class="tab-button cormorant font-bold">üìã Historique</button>
                    <button onclick="showTab('config')" id="tab-config" class="tab-button cormorant font-bold">‚öôÔ∏è Config</button>
                </div>
        
        <!-- G√©n√©rateur -->
        <div id="content-generator" class="tab-content">
            <div class="bg-gradient-to-br from-gray-900 to-black border border-yellow-900/30 rounded-2xl p-6 sm:p-8 shadow-2xl">
                <h2 class="brittany text-3xl mb-6 text-center" style="color:#B9A378">ü™Ñ G√©n√©rateur de Liens Personnalis√©s</h2>

                <!-- Layout 2 colonnes sur grand √©cran -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                    
                    <!-- Colonne gauche : infos client + bouton g√©n√©rer -->
                    <div class="bg-yellow-900/20 border border-yellow-700/30 rounded-xl p-6">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="georgia text-sm text-gray-400 mb-2 block">Pr√©nom du client</label>
                                <input type="text" id="genName" class="input-field" placeholder="Marie"/>
                            </div>
                            <div>
                                <label class="georgia text-sm text-gray-400 mb-2 block">T√©l√©phone</label>
                                <input type="tel" id="genPhone" class="input-field" placeholder="0612345678"/>
                            </div>
                            <div class="sm:col-span-2">
                                <label class="georgia text-sm text-gray-400 mb-2 block">Email du client</label>
                                <input type="email" id="genEmail" class="input-field" placeholder="client@exemple.com"/>
                            </div>
                        </div>

                        <div class="mb-6">
                            <label class="georgia text-sm text-gray-400 mb-2 block">Plateforme de r√©servation</label>
                            <select id="genChannel" class="input-field">
                                <option value="direct">‚≠ê Direct (Google)</option>
                                <option value="booking">üè® Booking.com</option>
                                <option value="airbnb">üè† Airbnb</option>
                            </select>
                        </div>

                        <button onclick="generateShortLink()" id="generateBtn"
                                class="cormorant w-full py-4 px-6 rounded-xl font-bold text-xl text-black transition-all duration-300 hover:scale-105"
                                style="background:linear-gradient(135deg,#B9A378 0%,#8B7355 100%)">
                            ü™Ñ G√©n√©rer le lien court
                        </button>
                        <p class="text-xs text-gray-500 text-center mt-2">
                            ‚ú® Lien court = plus professionnel en SMS
                        </p>
                    </div>

                    <!-- Colonne droite : r√©sultats -->
                    <div id="generatedResult" class="hidden">
                        <div class="bg-gradient-to-br from-gray-900 to-black border-2 border-yellow-700 rounded-2xl p-6 mb-6">
                            <h3 class="georgia font-bold text-xl mb-4 text-center" style="color:#B9A378">üì± Liens d'avis</h3>

                            <!-- Lien court -->
                            <div class="bg-black/30 rounded-xl p-4 mb-4">
                                <p class="text-sm text-gray-400 mb-2">Lien court (√† envoyer en SMS) :</p>
                                <div class="flex gap-2">
                                    <input type="text" id="shortLinkInput" class="input-field text-sm" readonly/>
                                    <button onclick="copyShortLink()"
                                            class="cormorant py-2 px-4 rounded-lg font-bold text-sm text-black transition-all duration-300 hover:scale-105"
                                            style="background:linear-gradient(135deg,#B9A378 0%,#8B7355 100%)">
                                        üìã
                                    </button>
                                </div>
                                <p class="georgia text-xs text-center text-gray-500 mt-2">
                                    ‚ú® C‚Äôest ce lien qui part dans le SMS
                                </p>
                            </div>

                            <!-- Bouton SMS -->
                            <button type="button"
                                    onclick="copySmsText()"
                                    class="cormorant w-full mt-2 py-3 px-4 rounded-lg font-bold text-sm text-black transition-all duration-300 hover:scale-105"
                                    style="background:linear-gradient(135deg,#F5E3C3 0%,#B9A378 100%);">
                                üì≤ Copier le SMS pr√™t √† envoyer
                            </button>

                            <!-- Lien long en option -->
                            <details class="mt-4">
                                <summary class="georgia text-sm text-gray-400 cursor-pointer">
                                    Afficher le lien long (optionnel)
                                </summary>
                                <div class="mt-3 bg-black/30 rounded-xl p-4">
                                    <p class="text-sm text-gray-400 mb-2">Lien long complet :</p>
                                    <div class="flex gap-2">
                                        <input type="text" id="longLinkInput" class="input-field text-xs" readonly/>
                                        <button onclick="copyLongLink()"
                                                class="cormorant py-2 px-4 rounded-lg font-bold text-sm text-black transition-all duration-300 hover:scale-105"
                                                style="background:linear-gradient(135deg,#B9A378 0%,#8B7355 100%)">
                                            üìã
                                        </button>
                                    </div>
                                </div>
                            </details>
                        </div>

                        <!-- Bloc QR code -->
                        <div class="bg-gradient-to-br from-gray-900 to-black border-2 border-yellow-700 rounded-2xl p-6">
                            <h3 class="georgia font-bold text-xl mb-4 text-center" style="color:#B9A378">üì∏ QR Code</h3>
                            <div class="flex justify-center mb-4">
                                <div id="qrcodeCanvas"></div>
                            </div>
                            <div class="flex gap-3">
                                <button onclick="downloadQRCode()"
                                        class="cormorant flex-1 py-3 px-6 rounded-xl font-bold text-black transition-all duration-300 hover:scale-105"
                                        style="background:linear-gradient(135deg,#B9A378 0%,#8B7355 100%)">
                                    üì• T√©l√©charger
                                </button>
                                <button onclick="printQRCode()"
                                        class="cormorant flex-1 py-3 px-6 rounded-xl font-bold border-2 border-yellow-700 text-white transition-all duration-300 hover:bg-yellow-900/20">
                                    üñ®Ô∏è Imprimer
                                </button>
                            </div>
                            <p class="georgia text-xs text-center text-gray-500 mt-4">
                                üí° Imprimez et laissez le QR Code dans la chambre !
                            </p>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- Stats -->
        <div id="content-stats" class="tab-content hidden">
            <div class="bg-gradient-to-br from-gray-900 to-black border border-yellow-900/30 rounded-2xl p-6 sm:p-8 shadow-2xl">
                <h2 class="brittany text-3xl mb-6" style="color:#B9A378">Statistiques d√©taill√©es</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-slate-900/70 border border-slate-700/60 rounded-2xl p-4">
                        <h3 class="georgia font-semibold text-sm mb-3 text-gray-200">R√©partition des canaux</h3>
                        <div class="space-y-2 text-xs georgia">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <span class="badge-direct badge-dot"></span>
                                    <span>Google direct</span>
                                </div>
                                <span id="statsDirect">‚Äì</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <span class="badge-booking badge-dot"></span>
                                    <span>Booking.com</span>
                                </div>
                                <span id="statsBooking">‚Äì</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <span class="badge-airbnb badge-dot"></span>
                                    <span>Airbnb</span>
                                </div>
                                <span id="statsAirbnb">‚Äì</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-slate-900/70 border border-slate-700/60 rounded-2xl p-4">
                        <h3 class="georgia font-semibold text-sm mb-3 text-gray-200">Parcours du jeu</h3>
                        <div class="space-y-2 text-xs georgia">
                            <div class="flex items-center justify-between">
                                <span>Clients ayant cliqu√© sur un bouton d'avis</span>
                                <span id="statsReviewClicks">‚Äì</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span>Clients ayant gratt√© leur cadeau</span>
                                <span id="statsScratch">‚Äì</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-slate-900/70 border border-slate-700/60 rounded-2xl p-4 md:col-span-2">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="georgia font-semibold text-sm text-gray-200">Export des donn√©es</h3>
                            <button onclick="exportData()" class="cormorant px-4 py-2 rounded-lg border border-yellow-700/60 text-xs hover:bg-yellow-900/30 transition">
                                üì• T√©l√©charger l'export CSV
                            </button>
                        </div>
                        <p class="georgia text-xs text-gray-400">
                            L'export CSV contient l'ensemble des participations : clients, canaux, lots, codes, clics sur les avis, etc.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lots -->
        <div id="content-prizes" class="tab-content hidden">
            <div class="bg-gradient-to-br from-gray-900 to-black border border-yellow-900/30 rounded-2xl p-6 sm:p-8 shadow-2xl">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
                    <h2 class="brittany text-3xl" style="color:#B9A378">Gestion des lots</h2>
                    <p class="georgia text-xs text-gray-400 max-w-md">
                        D√©finis les cadeaux que tes clients peuvent gagner apr√®s avoir laiss√© un avis.
                        Chaque lot peut avoir un nombre d'occurrences et une probabilit√© personnalis√©e.
                    </p>
                </div>

                <div class="grid lg:grid-cols-[1.8fr,1.2fr] gap-6">
                    <div>
                        <div id="prizeList" class="grid md:grid-cols-2 gap-4 mb-6"></div>
                        <button onclick="addPrize()" class="cormorant w-full py-3 px-4 rounded-xl font-bold text-sm text-black transition-all duration-300 hover:scale-105" style="background:linear-gradient(135deg,#B9A378 0%,#8B7355 100%)">
                            ‚ûï Ajouter un lot
                        </button>
                    </div>

                    <div class="bg-slate-900/80 border border-slate-700/70 rounded-2xl p-4">
                        <h3 class="georgia font-semibold text-sm mb-3 text-gray-200">Simulation globale</h3>
                        <div class="space-y-2 text-xs georgia mb-3" id="prizeSummary"></div>
                        <p class="georgia text-xs text-gray-400">
                            Utilise les probabilit√©s pour √©quilibrer l'exp√©rience : 
                            beaucoup de petites attentions, quelques gros cadeaux ‚ú®
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Historique -->
        <div id="content-history" class="tab-content hidden">
            <div class="bg-gradient-to-br from-gray-900 to-black border border-yellow-900/30 rounded-2xl p-6 sm:p-8 shadow-2xl">
                <h2 class="brittany text-3xl mb-6" style="color:#B9A378">Historique des participations</h2>

                <div class="overflow-x-auto">
                    <table class="georgia text-sm">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Client</th>
                                <th>Email</th>
                                <th>T√©l√©phone</th>
                                <th>Canal</th>
                                <th>Lot</th>
                                <th>Code</th>
                                <th>Avis</th>
                                <th>Utilis√©</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="historyTable">
                            <tr>
                                <td colspan="10" class="text-center text-gray-500 py-8">
                                    Aucune participation
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Config -->
        <div id="content-config" class="tab-content hidden">
            <div class="bg-gradient-to-br from-gray-900 to-black border border-yellow-900/30 rounded-2xl p-6 sm:p-8 shadow-2xl">
                <h2 class="brittany text-3xl mb-6" style="color:#B9A378">Configuration du parcours</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div class="bg-slate-900/80 border border-slate-700/80 rounded-2xl p-4">
                            <h3 class="georgia font-semibold text-sm mb-3 text-gray-200">Liens publics</h3>
                            <div class="space-y-3 text-xs georgia">
                                <div>
                                    <p class="text-gray-400 mb-1">URL publique de la page de jeu</p>
                                    <input type="text" id="publicUrl" class="input-field text-xs" placeholder="https://gami.rocandlove.fr"/>
                                    <p class="text-[0.7rem] text-gray-500 mt-1">C'est le lien final vers lequel les clients sont redirig√©s apr√®s le lien court.</p>
                                </div>
                                <div>
                                    <p class="text-gray-400 mb-1">URL de votre site (base pour le lien long historique)</p>
                                    <input type="text" id="siteUrl" class="input-field text-xs" placeholder="https://gami.rocandlove.fr"/>
                                </div>
                            </div>
                        </div>

                        <div class="bg-slate-900/80 border border-slate-700/80 rounded-2xl p-4">
                            <h3 class="georgia font-semibold text-sm mb-3 text-gray-200">Avis & plateforme</h3>
                            <div class="space-y-3 text-xs georgia">
                                <div>
                                    <p class="text-gray-400 mb-1">Lien vers la fiche Google Roc & Love</p>
                                    <input type="text" id="googleUrl" class="input-field text-xs" placeholder="https://g.page/..."/>
                                </div>
                                <div>
                                    <p class="text-gray-400 mb-1">Lien vers la page Booking.com</p>
                                    <input type="text" id="bookingUrl" class="input-field text-xs" placeholder="https://www.booking.com/..."/>
                                </div>
                                <div>
                                    <p class="text-gray-400 mb-1">Lien vers la page Airbnb</p>
                                    <input type="text" id="airbnbUrl" class="input-field text-xs" placeholder="https://www.airbnb.fr/..."/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="bg-slate-900/80 border border-slate-700/80 rounded-2xl p-4">
                            <h3 class="georgia font-semibold text-sm mb-3 text-gray-200">S√©curit√© admin</h3>
                            <div class="space-y-3 text-xs georgia">
                                <div class="flex items-center justify-between gap-3">
                                    <div>
                                        <p class="text-gray-400 mb-1">Mot de passe admin</p>
                                        <input type="password" id="adminPassword" class="input-field text-xs" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/>
                                        <p class="text-[0.7rem] text-gray-500 mt-1">Utilis√© pour acc√©der au dashboard (prot√©g√© c√¥t√© Vercel).</p>
                                    </div>
                                    <button onclick="togglePasswordVisibility()" class="cormorant text-xs px-3 py-2 rounded-lg border border-slate-600 hover:bg-slate-800/60">
                                        üëÅÔ∏è
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="bg-slate-900/80 border border-slate-700/80 rounded-2xl p-4">
                            <h3 class="georgia font-semibold text-sm mb-3 text-gray-200">Divers</h3>
                            <div class="space-y-3 text-xs georgia">
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-300">Mode debug (afficher les logs)</span>
                                    <label class="switch">
                                        <input type="checkbox" id="debugMode">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <p class="text-[0.7rem] text-gray-500">√Ä utiliser uniquement si tu dois comprendre un bug ou un comportement √©trange.</p>
                            </div>
                        </div>

                        <div class="flex justify-end gap-3 pt-2">
                            <button onclick="resetConfig()" class="cormorant px-4 py-2 rounded-lg border border-red-800/70 text-xs text-red-300 hover:bg-red-900/20">
                                R√©initialiser
                            </button>
                            <button onclick="saveConfig()" class="cormorant px-4 py-2 rounded-lg border border-emerald-700/70 text-xs text-emerald-200 hover:bg-emerald-900/20">
                                üíæ Sauvegarder la config
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

            </section>
        </main>
    </div>

    <script>
        let adminData=[],isPasswordVisible=!1,prizes=[],editingPrizeId=null,currentQRCode=null;

        function showTab(tabId){
            document.querySelectorAll('.tab-content').forEach(t=>t.classList.add('hidden'));
            document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
            document.getElementById('content-'+tabId).classList.remove('hidden');
            document.getElementById('tab-'+tabId).classList.add('active')
        }

        function getChannelBadge(channel){
            switch(channel){
                case 'direct':
                    return '<span class="badge badge-direct"><span class="badge-dot"></span><span>Direct</span></span>';
                case 'booking':
                    return '<span class="badge badge-booking"><span class="badge-dot"></span><span>Booking</span></span>';
                case 'airbnb':
                    return '<span class="badge badge-airbnb"><span class="badge-dot"></span><span>Airbnb</span></span>';
                default:
                    return '<span class="badge"><span class="badge-dot" style="background:#9ca3af"></span><span>Autre</span></span>'
            }
        }

        function updateStats(){
            const total=adminData.length;
            document.getElementById('totalReviews').textContent=total||'‚Äì';
            if(0===total){
                document.getElementById('clickRate').textContent='‚Äì';
                document.getElementById('googleReviews').textContent='‚Äì';
                document.getElementById('scratchRate').textContent='‚Äì';
                document.getElementById('statsDirect').textContent='‚Äì';
                document.getElementById('statsBooking').textContent='‚Äì';
                document.getElementById('statsAirbnb').textContent='‚Äì';
                document.getElementById('statsReviewClicks').textContent='‚Äì';
                document.getElementById('statsScratch').textContent='‚Äì';
                return
            }
            const clicks=adminData.filter(d=>d.reviewClicked).length,
                  scratches=adminData.filter(d=>d.scratched).length,
                  direct=adminData.filter(d=>'direct'===d.channel).length,
                  booking=adminData.filter(d=>'booking'===d.channel).length,
                  airbnb=adminData.filter(d=>'airbnb'===d.channel).length;
            document.getElementById('clickRate').textContent=Math.round(clicks/total*100)+'%';
            document.getElementById('scratchRate').textContent=Math.round(scratches/total*100)+'%';
            document.getElementById('statsDirect').textContent=direct+' ('+Math.round(direct/total*100)+'%)';
            document.getElementById('statsBooking').textContent=booking+' ('+Math.round(booking/total*100)+'%)';
            document.getElementById('statsAirbnb').textContent=airbnb+' ('+Math.round(airbnb/total*100)+'%)';
            document.getElementById('statsReviewClicks').textContent=clicks+' ('+Math.round(clicks/total*100)+'%)';
            document.getElementById('googleReviews').textContent=direct+' ('+Math.round(direct/total*100)+'%)';
            document.getElementById('statsScratch').textContent=scratches+' ('+Math.round(scratches/total*100)+'%)'
        }

        async function loadFromNeon(){
            try{
                const response=await fetch('/api/get-participations');
                if(!response.ok){
                    console.error('Erreur chargement');
                    adminData=[];
                    return
                }
                const data=await response.json();
                if(data.success&&data.participations){
                    adminData=data.participations.map(p=>({
                        sessionId:p.session_id,
                        clientName:p.client_name,
                        clientPhone:p.client_phone,
                        clientEmail:p.client_email,
                        prize:{emoji:p.prize_emoji,title:p.prize_title,description:p.prize_description},
                        code:p.promo_code,
                        date:p.created_at,
                        reviewClicked:p.review_clicked,
                        scratched:p.scratched,
                        channel:p.channel,
                        used:p.used||!1
                    }))
                }
            }catch(error){
                console.error('Erreur API:',error);
                adminData=[]
            }
        }

        function updateHistory(){
            const tbody=document.getElementById('historyTable');
            if(0===adminData.length){
                tbody.innerHTML='<tr><td colspan="10" class="text-center text-gray-500 py-8">Aucune participation</td></tr>';
                return
            }
            const sortedData=[...adminData].sort((a,b)=>new Date(b.date)-new Date(a.date));
            tbody.innerHTML=sortedData.map(item=>{
                const date=new Date(item.date),
                      dateStr=date.toLocaleDateString('fr-FR',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'}),
                      clientName=item.clientName||'Non renseign√©',
                      clientPhone=item.clientPhone||'Non renseign√©',
                      clientEmail=item.clientEmail||'Non renseign√©',
                      channel=item.channel||'direct',
                      prizeTitle=item.prize?.title||'Inconnu',
                      prizeEmoji=item.prize?.emoji||'üéÅ',
                      code=item.code||'N/A',
                      reviewIcon=item.reviewClicked?'‚úÖ':'‚ùå',
                      used=!!item.used;

                const emailCell=clientEmail&&'Non renseign√©'!==clientEmail
                    ?`<a href="mailto:${clientEmail}" class="text-yellow-700 hover:text-yellow-500">${clientEmail}</a>`
                    :clientEmail;

                const phoneCell=clientPhone&&'Non renseign√©'!==clientPhone
                    ?`<a href="tel:${clientPhone}" class="text-yellow-700 hover:text-yellow-500">${clientPhone}</a>`
                    :clientPhone;

                return `
                    <tr>
                        <td>${dateStr}</td>
                        <td class="font-semibold">${clientName}</td>
                        <td>${emailCell}</td>
                        <td>${phoneCell}</td>
                        <td>${getChannelBadge(channel)}</td>
                        <td>${prizeEmoji} ${prizeTitle}</td>
                        <td><span class="code-badge code-${code}">${code}</span></td>
                        <td class="text-center">${reviewIcon}</td>
                        <td class="text-center">
                            <input type="checkbox" ${used?'checked':''} onchange="toggleUsed('${item.sessionId}',this.checked)"/>
                        </td>
                        <td>
                            <button onclick="deleteEntry('${item.sessionId}')" class="text-red-400 hover:text-red-300 text-xs">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            }).join('')
        }

        function toggleUsed(sessionId,used){
            const item=adminData.find(d=>d.sessionId===sessionId);
            item&&(item.used=used)
        }

        function updateConfigView(){
            const siteUrlInput=document.getElementById('siteUrl'),
                  publicUrlInput=document.getElementById('publicUrl'),
                  googleUrlInput=document.getElementById('googleUrl'),
                  bookingUrlInput=document.getElementById('bookingUrl'),
                  airbnbUrlInput=document.getElementById('airbnbUrl'),
                  adminPasswordInput=document.getElementById('adminPassword'),
                  debugModeInput=document.getElementById('debugMode');
            siteUrlInput&&(siteUrlInput.value=window.dashboardConfig?.siteUrl||'');
            publicUrlInput&&(publicUrlInput.value=window.dashboardConfig?.publicUrl||'');
            googleUrlInput&&(googleUrlInput.value=window.dashboardConfig?.googleUrl||'');
            bookingUrlInput&&(bookingUrlInput.value=window.dashboardConfig?.bookingUrl||'');
            airbnbUrlInput&&(airbnbUrlInput.value=window.dashboardConfig?.airbnbUrl||'');
            adminPasswordInput&&(adminPasswordInput.value=window.dashboardConfig?.adminPassword||'');
            debugModeInput&&(debugModeInput.checked=!!window.dashboardConfig?.debugMode)
        }

        async function loadConfig(){
            try{
                const response=await fetch('/api/get-config');
                if(!response.ok)throw new Error('Erreur HTTP '+response.status);
                const data=await response.json();
                if(data.success){
                    window.dashboardConfig=data.config||{};
                    updateConfigView()
                }
            }catch(error){
                console.error('Erreur chargement config:',error);
                window.dashboardConfig={}
            }
        }

        async function saveConfig(){
            const siteUrl=document.getElementById('siteUrl').value.trim(),
                  publicUrl=document.getElementById('publicUrl').value.trim(),
                  googleUrl=document.getElementById('googleUrl').value.trim(),
                  bookingUrl=document.getElementById('bookingUrl').value.trim(),
                  airbnbUrl=document.getElementById('airbnbUrl').value.trim(),
                  adminPassword=document.getElementById('adminPassword').value.trim(),
                  debugMode=document.getElementById('debugMode').checked;
            try{
                const response=await fetch('/api/save-config',{
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({siteUrl,publicUrl,googleUrl,bookingUrl,airbnbUrl,adminPassword,debugMode})
                });
                if(!response.ok)throw new Error('Erreur HTTP '+response.status);
                const data=await response.json();
                if(data.success){
                    alert('Configuration sauvegard√©e ‚úÖ');
                    window.dashboardConfig={siteUrl,publicUrl,googleUrl,bookingUrl,airbnbUrl,adminPassword,debugMode}
                }else alert('Erreur lors de la sauvegarde')
            }catch(error){
                console.error('Erreur sauvegarde config:',error);
                alert('Erreur lors de la sauvegarde de la configuration.')
            }
        }

        function resetConfig(){
            if(!confirm('R√©initialiser toute la configuration ?'))return;
            window.dashboardConfig={};
            updateConfigView()
        }

        function togglePasswordVisibility(){
            const input=document.getElementById('adminPassword');
            if(!input)return;
            isPasswordVisible=!isPasswordVisible;
            input.type=isPasswordVisible?'text':'password'
        }

        async function exportData(){
            if(!adminData.length){
                alert('Aucune donn√©e √† exporter');
                return
            }
            const header=['Date','Nom','Email','T√©l√©phone','Canal','Lot','Code','Avis cliqu√©','Gratt√©','Session ID'];
            const rows=adminData.map(item=>[
                item.date,
                item.clientName||'',
                item.clientEmail||'',
                item.clientPhone||'',
                item.channel||'',
                item.prize?.title||'',
                item.code||'',
                item.reviewClicked?'1':'0',
                item.scratched?'1':'0',
                item.sessionId||''
            ]);
            const csvContent=[header,...rows].map(row=>row.map(field=>`"${(field||'').toString().replace(/"/g,'""')}"`).join(',')).join('\n');
            const blob=new Blob([csvContent],{type:'text/csv;charset=utf-8;'});
            const url=URL.createObjectURL(blob);
            const link=document.createElement('a');
            link.href=url;
            link.download='rocandlove_participations.csv';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url)
        }

        function renderPrizes(){
            const container=document.getElementById('prizeList'),
                  summary=document.getElementById('prizeSummary');
            if(!container)return;
            if(0===prizes.length){
                container.innerHTML='<p class="text-xs text-gray-500 georgia">Aucun lot configur√© pour le moment.</p>';
                summary.innerHTML='<p class="text-xs text-gray-500 georgia">Ajoute au moins un lot pour activer le jeu.</p>';
                return
            }
            container.innerHTML=prizes.map(prize=>`
                <div class="prize-card">
                    <div class="flex items-start justify-between gap-2 mb-2">
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-xl">${prize.emoji||'üéÅ'}</span>
                                <h3 class="georgia font-semibold text-sm text-gray-100">${prize.title||'Lot sans titre'}</h3>
                            </div>
                            <p class="georgia text-xs text-gray-400">${prize.description||''}</p>
                        </div>
                        <button onclick="editPrize('${prize.id}')" class="text-xs text-yellow-300 hover:text-yellow-100">Modifier</button>
                    </div>
                    <div class="grid grid-cols-2 gap-3 mt-3 text-[0.7rem] georgia">
                        <div>
                            <p class="text-gray-400 mb-1">Probabilit√©</p>
                            <p class="font-semibold text-yellow-200">${prize.probability||0}%</p>
                        </div>
                        <div>
                            <p class="text-gray-400 mb-1">Occurrences max</p>
                            <p class="font-semibold text-gray-200">${prize.maxOccurrences||'‚àû'}</p>
                        </div>
                    </div>
                </div>
            `).join('');
            const totalProb=prizes.reduce((sum,p)=>sum+(parseFloat(p.probability)||0),0);
            summary.innerHTML=`
                <p class="text-xs text-gray-300 mb-2">Nombre de lots configur√©s : <span class="font-semibold">${prizes.length}</span></p>
                <p class="text-xs ${totalProb>100?'text-red-300':'text-gray-400'}">
                    Somme des probabilit√©s : <span class="font-semibold">${totalProb}%</span> 
                    ${totalProb>100?'(‚ö†Ô∏è sup√©rieure √† 100%, √† r√©√©quilibrer)':'(ok si inf√©rieure ou √©gale √† 100%)'}
                </p>
            `
        }

        function addPrize(){
            const id='prize_'+Date.now();
            prizes.push({id,title:'Nouveau lot',emoji:'üéÅ',description:'',probability:10,maxOccurrences:null});
            editingPrizeId=id;
            openPrizeModal()
        }

        function editPrize(id){
            editingPrizeId=id;
            openPrizeModal()
        }

        function openPrizeModal(){
            const prize=prizes.find(p=>p.id===editingPrizeId);
            if(!prize)return;
            const title=prompt('Titre du lot :',prize.title||'');
            if(null===title)return;
            const emoji=prompt('Emoji (facultatif) :',prize.emoji||'üéÅ')||'üéÅ';
            const description=prompt('Description :',prize.description||'')||'';
            const probabilityStr=prompt('Probabilit√© (%) :',prize.probability||10);
            const probability=parseFloat(probabilityStr)||0;
            const maxOccurrencesStr=prompt("Nombre maximum d'occurrences (laisser vide pour illimit√©) :",prize.maxOccurrences||'');
            const maxOccurrences=maxOccurrencesStr?parseInt(maxOccurrencesStr,10):null;
            prize.title=title;
            prize.emoji=emoji;
            prize.description=description;
            prize.probability=probability;
            prize.maxOccurrences=maxOccurrences;
            renderPrizes()
        }

        async function loadPrizes(){
            try{
                const response=await fetch('/api/get-prizes');
                if(!response.ok)throw new Error('Erreur HTTP '+response.status);
                const data=await response.json();
                if(data.success&&Array.isArray(data.prizes)){
                    prizes=data.prizes;
                    renderPrizes()
                }
            }catch(error){
                console.error('Erreur chargement lots:',error);
                prizes=[];
                renderPrizes()
            }
        }

        async function saveNote(sessionId,note){
            try{
                const response=await fetch('/api/save-note',{
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({sessionId,note})
                });
                response.ok||console.error('Erreur sauvegarde note')
            }catch(error){
                console.error('Erreur API note:',error)
            }
        }

        async function deleteEntry(sessionId){
            if(!confirm('Supprimer cette entr√©e ?'))return;
            try{
                const response=await fetch('/api/delete-participation',{
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({sessionId})
                });
                if(response.ok){
                    adminData=adminData.filter(d=>d.sessionId!==sessionId);
                    updateHistory();
                    updateStats()
                }else console.error('Erreur suppression')
            }catch(error){
                console.error('Erreur API suppression:',error)
            }
        }

        async function loadData(){
            await Promise.all([loadFromNeon(),loadConfig(),loadPrizes()]);
            updateHistory();
            updateStats()
        }

        document.addEventListener('DOMContentLoaded',()=>{
            loadData();
            showTab('generator')
        });
    </script>

    <script>
    // Gestion du QR code bas√© sur le lien court
    let currentQRCodeUrl = null;

    // ‚öôÔ∏è G√©n√©rer un lien court via l'API Vercel
    window.generateShortLink = async function () {
        const nameEl = document.getElementById('genName');
        const phoneEl = document.getElementById('genPhone');
        const emailEl = document.getElementById('genEmail');
        const channelEl = document.getElementById('genChannel');

        const shortInput = document.getElementById('shortLinkInput');
        const longInput = document.getElementById('longLinkInput');
        const resultBlock = document.getElementById('generatedResult');
        const qrContainer = document.getElementById('qrcodeCanvas');
        const btn = document.getElementById('generateBtn');

        const clientName = (nameEl.value || '').trim();
        const clientPhone = (phoneEl.value || '').trim();
        const clientEmail = (emailEl.value || '').trim();
        const channel = channelEl.value;

        if (!clientName) {
            alert("Merci d'entrer le pr√©nom du client");
            return;
        }

        if (!clientPhone) {
            alert("Merci d'indiquer le t√©l√©phone du client");
            return;
        }

        if (!clientEmail) {
            alert("L‚Äôemail est obligatoire pour le jeu (envoi du code par mail). Merci de le renseigner.");
            return;
        }

        // üîó Base du site (utilise le champ Config si pr√©sent, sinon domaine par d√©faut)
        const siteUrlField = document.getElementById('siteUrl');
        const baseUrl = siteUrlField && siteUrlField.value
            ? siteUrlField.value.trim()
            : 'https://gami.rocandlove.fr';

        // Lien long historique : ?n=...&t=...&e=...&s=...
        const longUrl = `${baseUrl}/?n=${encodeURIComponent(clientName)}&t=${encodeURIComponent(clientPhone)}&e=${encodeURIComponent(clientEmail)}&s=${encodeURIComponent(channel)}`;

        // Reset affichage
        if (shortInput) shortInput.value = '';
        if (longInput) longInput.value = '';
        if (qrContainer) qrContainer.innerHTML = '';
        currentQRCodeUrl = null;
        if (resultBlock) resultBlock.classList.add('hidden');

        // Feedback visuel sur le bouton
        const originalBtnText = btn ? btn.innerHTML : '';
        if (btn) {
            btn.disabled = true;
            btn.innerHTML = '‚è≥ G√©n√©ration...';
        }

        try {
            // üì° Appel √† l‚ÄôAPI /api/create-short-link
            const response = await fetch('/api/create-short-link', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    clientName: clientName,
                    clientPhone: clientPhone,
                    clientEmail: clientEmail,
                    channel: channel
                })
            });

            if (!response.ok) {
                throw new Error('R√©ponse HTTP non OK : ' + response.status);
            }

            const data = await response.json();

            // Format attendu : { success: true, shortUrl: "https://gami.rocandlove.fr/l/xxxxx", code: "xxxxx" }
            if (!data.success || !data.shortUrl) {
                throw new Error('R√©ponse de l‚ÄôAPI invalide ou incompl√®te.');
            }

            const shortUrl = data.shortUrl;

            // ‚úÖ Remplir les champs
            if (shortInput) shortInput.value = shortUrl;
            if (longInput) longInput.value = longUrl;
            if (resultBlock) resultBlock.classList.remove('hidden');

            // ‚úÖ G√©n√©ration du QR √† partir du lien court
            const qrApi = 'https://api.qrserver.com/v1/create-qr-code/?size=256x256&data=';
            currentQRCodeUrl = qrApi + encodeURIComponent(shortUrl);

            if (qrContainer) {
                qrContainer.innerHTML = `
                    <img src="${currentQRCodeUrl}"
                         alt="QR Code"
                         style="border: 4px solid #B9A378; border-radius: 1rem; padding: 1rem; background: #fff; display: block; margin: 0 auto;"
                    />
                `;
            }

        } catch (error) {
            console.error(error);
            alert("Erreur lors de la g√©n√©ration du lien court. V√©rifie que l‚ÄôAPI /api/create-short-link fonctionne bien.");
        } finally {
            if (btn) {
                btn.disabled = false;
                btn.innerHTML = originalBtnText || 'ü™Ñ G√©n√©rer le lien court';
            }
        }
    };

    // üìã Copier le lien court
    window.copyShortLink = function () {
        const input = document.getElementById('shortLinkInput');
        if (!input || !input.value) {
            alert('Aucun lien court √† copier pour le moment.');
            return;
        }

        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(input.value)
                .then(() => alert('Lien court copi√© dans le presse-papiers ‚úÖ'))
                .catch(() => alert('Impossible de copier automatiquement. S√©lectionne le lien et copie-le manuellement.'));
        } else {
            alert('Ton navigateur ne permet pas la copie automatique. S√©lectionne le lien et copie-le manuellement.');
        }
    };

    // üìã Copier le lien long
    window.copyLongLink = function () {
        const input = document.getElementById('longLinkInput');
        if (!input || !input.value) {
            alert('Aucun lien long √† copier pour le moment.');
            return;
        }

        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(input.value)
                .then(() => alert('Lien long copi√© dans le presse-papiers ‚úÖ'))
                .catch(() => alert('Impossible de copier automatiquement. S√©lectionne le lien et copie-le manuellement.'));
        } else {
            alert('Ton navigateur ne permet pas la copie automatique. S√©lectionne le lien et copie-le manuellement.');
        }
    };

    // üì≤ Copier le SMS pr√™t √† envoyer
    window.copySmsText = function () {
        const name = (document.getElementById('genName').value || '').trim();
        const email = (document.getElementById('genEmail').value || '').trim();
        const shortInput = document.getElementById('shortLinkInput');
        const shortUrl = (shortInput && shortInput.value || '').trim();

        if (!shortUrl) {
            alert('G√©n√®re d\'abord un lien court avant de copier le SMS.');
            return;
        }

        if (!name) {
            alert('Merci d‚Äôindiquer le pr√©nom du client pour personnaliser le SMS.');
            return;
        }

        if (!email) {
            alert('L‚Äôemail est obligatoire pour le jeu (envoi du code par mail). Merci de le renseigner.');
            return;
        }

        const firstName = name;

        const message =
`Bonjour ${firstName}, merci pour votre s√©jour chez Roc & Love üíõ
Laissez-nous un petit avis et d√©couvrez votre cadeau üéÅ : ${shortUrl}
Merci pour votre soutien ü•∞
Gwen & Val ‚Äì Roc & Love`;

        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(message)
                .then(() => {
                    alert('SMS copi√© ‚úÖ Tu peux maintenant le coller dans ton application de SMS üì≤');
                })
                .catch(() => {
                    alert('Impossible de copier automatiquement. S√©lectionne le texte du SMS manuellement.');
                });
        } else {
            alert('Ton navigateur ne permet pas la copie automatique. Il faudra saisir le SMS manuellement.');
        }
    };

    // üì• T√©l√©charger le QR code
    window.downloadQRCode = function () {
        if (!currentQRCodeUrl) {
            alert('‚ö†Ô∏è G√©n√©rez d\'abord un lien');
            return;
        }

        const name = (document.getElementById('genName').value || '').trim();
        const link = document.createElement('a');
        link.href = currentQRCodeUrl;
        link.download = `qrcode-${name || 'client'}.png`;
        link.target = '_blank';
        link.click();
    };

    // üñ®Ô∏è Imprimer le QR code
    window.printQRCode = function () {
        if (!currentQRCodeUrl) {
            alert('‚ö†Ô∏è G√©n√©rez d\'abord un lien');
            return;
        }

        const name = (document.getElementById('genName').value || '').trim();
        const win = window.open('', '_blank');
        win.document.write(`
            <html>
            <head>
                <title>QR Code - ${name}</title>
                <style>
                    body {
                        text-align: center;
                        font-family: Georgia, serif;
                        padding: 2rem;
                    }
                    h2 { color: #B9A378; }
                    img { margin: 2rem auto; }
                </style>
            </head>
            <body>
                <h2>Roc & Love - QR Code</h2>
                <p style="font-size: 1.2rem; margin: 1rem;">${name}</p>
                <img src="${currentQRCodeUrl}" alt="QR Code" />
                <p style="font-size: 0.9rem; color: #666;">Scannez ce code pour acc√©der √† votre surprise</p>
            </body>
            </html>
        `);
        win.document.close();
        setTimeout(() => win.print(), 500);
    };

    console.log('‚úÖ G√©n√©ration de liens courts active');
    </script>

</body>
</html>
